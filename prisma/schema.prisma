// Prisma schema for Gala 2026 - Seating and Auction Management
// Database: Neon PostgreSQL

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Seating assignments - stores who sits where
model Seat {
  id             String   @id @default(cuid())
  tableNumber    Int      // 1-12
  seatNumber     Int      // 1-10 (seat position at table)
  registrationId String?  // FK to Registration, nullable if unassigned
  registration   Registration? @relation(fields: [registrationId], references: [id])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@unique([tableNumber, seatNumber])
  @@index([tableNumber])
}

// Auction items
model AuctionItem {
  id          String   @id @default(cuid())
  title       String
  description String?
  imageUrl    String?
  startingBid Float   @default(0)
  currentBid  Float   @default(0)
  currentBidder String?
  endTime     DateTime?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  bids        Bid[]

  @@index([isActive])
}

// Bid history for auction items
model Bid {
  id            String   @id @default(cuid())
  auctionItemId String
  bidderName    String
  amount        Float
  createdAt     DateTime @default(now())

  auctionItem  AuctionItem @relation(fields: [auctionItemId], references: [id], onDelete: Cascade)

  @@index([auctionItemId])
  @@index([createdAt])
}

// Admin user (simple auth)
model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // bcrypt hash
  createdAt DateTime @default(now())
}

model Registration {
  id                String   @id @default(cuid())
  name              String
  email             String
  phone             String?
  tablePreference   Int?     // assigned table (nullable until assigned)
  seatPreference    Int?     // assigned seat (nullable until assigned)
  payment           Float    @default(0)
  paymentStatus     Boolean  @default(false)
  seatAssignedStatus Boolean @default(false)
  quote             String?
  bio               String?
  involvement       String?
  imageUrl          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  seat              Seat[]

  @@index([tablePreference, seatPreference])
  @@index([paymentStatus, seatAssignedStatus])
}

// Program model for event scheduling
model Program {
  id            Int       @id @default(autoincrement())
  title         String
  description   String?
  startTime     DateTime
  endTime       DateTime
  location      String?
  sequence      Int?
  speaker       String?
  speakerBio    String?
  type          String?
  visibility    Boolean   @default(true) // true = public, false = private
  imageUrl      String?
  externalLink  String?
  notes         String?
  capacity      Int?
  rsvpRequired  Boolean   @default(false)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}
